<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Hexo">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Hexo">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
  

</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-mysql性能入门" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/09/26/mysql性能入门/" class="article-date">
  <time datetime="2017-09-26T05:35:36.000Z" itemprop="datePublished">2017-09-26</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
    <div class="article-entry" itemprop="articleBody">
      
        <hr>
<p>title:mysql性能入门<br>tags:mysql</p>
<h2 id="categories-mysql"><a href="#categories-mysql" class="headerlink" title="categories:mysql"></a>categories:mysql</h2><ol>
<li><p>left join，right join，inner join，select in</p>
<p>最基本的sql语句，连表查询性能并没有想得那么差。尽量避免大表连小表的操作。</p>
</li>
<li><p>锁</p>
<p>mysql的锁有很多类，主要区别在于两点</p>
<ol>
<li>锁粒度</li>
<li>互斥性</li>
</ol>
<p>mysql有一下几类锁</p>
<ol>
<li>Shared and Exclusive Locks：读写锁</li>
<li>Intention Locks：意向锁：表或者行级别锁</li>
<li><ol>
<li><a href="https://dev.mysql.com/doc/refman/5.7/en/select.html" target="_blank" rel="external">SELECT … LOCK IN SHARE MODE</a> IS锁。读锁</li>
<li><a href="https://dev.mysql.com/doc/refman/5.7/en/select.html" target="_blank" rel="external">SELECT … FOR UPDATE</a> IX锁。写锁</li>
</ol>
</li>
<li>行级锁：用于锁定某一行数据，粒度</li>
<li>gap索引: 范围锁，a gap between index records, or a lock on the gap before the first or after the last index record。在read_repeatable级别有效，read_commited无效</li>
<li>Next-Key Locks: 行锁+gap锁，在read_repeatable级别有效，read_commited无效</li>
<li>Insert Intention Locks: 插入索引</li>
</ol>
</li>
<li><p>事务</p>
</li>
</ol>
<ol>
<li>隔离级别<ol>
<li><a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-transaction-isolation-levels.html#isolevel_read-uncommitted" target="_blank" rel="external">READ UNCOMMITTED</a></li>
<li><a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-transaction-isolation-levels.html#isolevel_read-committed" target="_blank" rel="external">READ COMMITTED</a> 阿里云默认，性能好些。不适用gap锁。在扫描数据的时候，会自动释放不符合条件的行锁</li>
<li><a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-transaction-isolation-levels.html#isolevel_repeatable-read" target="_blank" rel="external">REPEATABLE READ</a> innodb默认级别，mvcc，使用next-key lock</li>
<li><a href="https://dev.mysql.com/doc/refman/5.7/en/innodb-transaction-isolation-levels.html#isolevel_serializable" target="_blank" rel="external">SERIALIZABLE</a> 串行化</li>
</ol>
</li>
<li>Locking Reads<ol>
<li>share mode：SELECT … LOCK IN SHARE MODE。共享读锁</li>
<li>exclusive mode：SELECT … FOR UPDATE。排他锁</li>
</ol>
</li>
</ol>
<ol>
<li><p>索引：</p>
<ol>
<li>聚簇索引：索引和数据一起存储，读取效率高</li>
<li>二级索引：存储聚簇索引，读两次磁盘</li>
<li>主键uuid vs auto_increment bigint：二级索引存的是主键值，uuid太大。读取磁盘速度慢。索引不连续</li>
</ol>
</li>
</ol>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/09/26/mysql性能入门/" data-id="cj81680zc0005prbm2gvmougp" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-backend_share" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/09/11/backend_share/" class="article-date">
  <time datetime="2017-09-11T09:34:03.000Z" itemprop="datePublished">2017-09-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/11/backend_share/">微服务简介</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 align="center">作者：萧超杰 2017-09-04 </h4>


<h4 id="1-后端整体服务"><a href="#1-后端整体服务" class="headerlink" title="1.后端整体服务"></a>1.后端整体服务</h4><p>我们使用的技术包括：</p>
<p>开发：配置管理，服务发现，远程调用，网关，日志追踪</p>
<p>监控：prometheus监控，apm性能管理</p>
<p>部署：docker，k8s</p>
<p>基础组件：mysql，redis，mqtt，rabbitmq</p>
<h4 id="2-配置管理"><a href="#2-配置管理" class="headerlink" title="2.配置管理"></a>2.配置管理</h4><ul>
<li><p>代码配置分离</p>
<p>我们通过git集中化进行配置管理，配置和程序代码分离，即做到一份程序，多份配置，多处部署</p>
<p><img src="http://ovqe8818i.bkt.clouddn.com/WX20170901-144742@2x.png" alt="配置管理"></p>
</li>
</ul>
<ul>
<li><p>实时刷新配置</p>
<p>通过springcloud-bus项目，我们可以实时动态热更新运行中的程序配置，避免修改配置需要重新打包发布</p>
<p><img src="http://ovqe8818i.bkt.clouddn.com/WX20170901-145050@2x.png" alt="动态刷新"></p>
</li>
<li><p>配置获取</p>
<p>通过域名conf.jinyi999.cn/{项目名称}/{环境} 获取应用相应环境的配置，比如<a href="http://conf.jinyi999.cn/ytx-sso/k8s或者sso项目k8s环境的配置" target="_blank" rel="external">http://conf.jinyi999.cn/ytx-sso/k8s或者sso项目k8s环境的配置</a></p>
<p><img src="http://ovqe8818i.bkt.clouddn.com/WX20170901-150127@2x.png" alt="配置"></p>
<p>​</p>
</li>
</ul>
<h4 id="3-服务注册发现"><a href="#3-服务注册发现" class="headerlink" title="3.服务注册发现"></a>3.服务注册发现</h4><ul>
<li><p>传统服务管理问题</p>
<p>传统服务通过域名管理，通过nginx代理服务域名，需要管理nginx和后端服务关系，在微服务时代，服务量级会不断增加，通过传统的nginx管理服务十分不便。比如新增节点，减少节点，都需要对nginx进行重新配置。通过获取服务信息也十分困难不便</p>
</li>
</ul>
<ul>
<li><p>服务发现好处</p>
<p>服务发现的好处在于，可以零编码的对所以服务进行动态管理，获取服务信息，如服务ip，端口，监控状态等。我们使用的是eureka进行服务发现管理。</p>
<p><img src="http://ovqe8818i.bkt.clouddn.com/WX20170901-152000@2x.png" alt="WX20170901-152000@2x"></p>
</li>
<li><p>服务发现模型</p>
<p>服务发现本身需要保证服务的分布式高可用，所以服务发现本身相对比较复杂。在分布式CAP理论基础上，eureka服务发现使用了AP模型，在网络出现问题时，保证了服务的可用性，牺牲了一致性</p>
</li>
<li><p>eureka高可用</p>
<p>我们部署了三台eureka服务，三个节点两两相互备份，保证服务的高可用性，任意一个节点挂了都不会影响服务的可用性</p>
<p><img src="http://ovqe8818i.bkt.clouddn.com/WX20170901-154026@2x.png" alt="WX20170901-154026@2x"></p>
<p>​</p>
</li>
</ul>
<h4 id="4-远程调用"><a href="#4-远程调用" class="headerlink" title="4.远程调用"></a>4.远程调用</h4><ul>
<li>远程调用简称RPC，在我们微服务体系中，我们选用了http作为远程调用协议（后续可以升级为gRpc等方式）。在springcloud体系中，我们使用了feign通过ribbon来进行远程调用。ribbon封装了httpclient或者okhttp，通过eureka获取服务地址并做负载均衡。我们使用了okhttp进行访问，提高http访问效率</li>
</ul>
<ul>
<li><p>重试机制</p>
<p>远程调用需要考虑重试，比如由于网络超时、服务不稳定等原因造成访问失败。ribbon提供的重试机制为：对于所有GET幂等请求进行重试，重试方式是本机重试或者重新选取一个节点重试。相关配置为：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">ribbon:</div><div class="line">  MaxAutoRetries: 1  			#本机重试一次</div><div class="line">  MaxAutoRetriesNextServer: 1	#重新选举一台重试</div><div class="line">  okhttp:</div><div class="line">    enabled: true				#使用okhttp</div><div class="line">    </div><div class="line">eureka:</div><div class="line">  registry-fetch-interval-seconds: 5	#5s从注册中心获取一次服务信息</div></pre></td></tr></table></figure>
</li>
</ul>
<h4 id="5-网关"><a href="#5-网关" class="headerlink" title="5.网关"></a>5.网关</h4><p>在微服务时间，服务数量相对传统单体应用会增加许多。我们通过统一的网关服务zuul代理访问所有的服务。</p>
<ul>
<li><p>网关好处</p>
<p>统一服务入口，避免客户端调用不同服务</p>
<p>统一日志管理</p>
<p>统一监控</p>
<p>统一权限控制</p>
<p>统一流量控制</p>
<p>通过网关，我们可以做很多工作，后续如蓝绿发布，a/b test等</p>
</li>
</ul>
<h4 id="6-日志追踪"><a href="#6-日志追踪" class="headerlink" title="6.日志追踪"></a>6.日志追踪</h4><p>在单体应用时代，所有服务日志在一个应用中，而在微服务时代，一次请求涉及多个服务，日志追踪就变的十分重要。我们使用springcloud-sleuth组件进行日志追踪管理，所有日志都会有一个traceid，当进行远程调用时，该traceid会被传递到下游服务。我们的日志样例如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">2017-09-01 16:09:56.828  INFO [zuul-server,e3459faf4e4115d8,e3459faf4e4115d8,false] 9 </div><div class="line">--- [nio-8041-exec-1] c.y.f.base.filter.RequestLoggingFilter   : </div><div class="line">After request [method=POST,After request [uri=/api/user-center/device/save;payload=&#123;&quot;deviceToken&quot;:&quot;dd6f96fb3a9c10e6f9087d5ab5291e37&quot;,</div><div class="line">&quot;deviceId&quot;:&quot;CC2165D8-BADC-476F-8ED8-B71A04CC2E41&quot;,&quot;userId&quot;:9,&quot;os&quot;:&quot;IOS&quot;,&quot;appVersion&quot;:&quot;1.5.0&quot;&#125;],</div><div class="line">time=12(ms),code=200]</div></pre></td></tr></table></figure>
<p>traceid=e3459faf4e4115d8，同时我们记录了每次请求的耗时和httpcode，方便排查问题</p>
<h4 id="7-监控"><a href="#7-监控" class="headerlink" title="7.监控"></a>7.监控</h4><p>我们所有的微服务使用springboot框架开发，集成了actuator模块，自动暴露了/health，/metrics等接口，通过springboot-admin模块，我们集成了eureka获取了所有模块的列表，通过每个模块的/health，/metrics接口获取模块信息。<br>springboot-admin模块页面如下:<br><img src="http://ovqe8818i.bkt.clouddn.com/WX20170907-092757@2x.png" alt="springboot-admin"><br>通过springboot-admin，我们可以实时观察到每个模块是否存活，健康状态</p>
<p>每个模块的内容包括：模块信息，调用情况，环境变量，调用情况<br><img src="http://ovqe8818i.bkt.clouddn.com/WX20170907-092832@2x.png" alt="springboot-admin"><br>比较有用的是模块信息，比如启动时间，内存占用等。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/09/11/backend_share/" data-id="cj81680yz0001prbmni3ugw7f" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  
    <article id="post-algorithm-stock" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/09/11/algorithm-stock/" class="article-date">
  <time datetime="2017-09-11T07:43:28.000Z" itemprop="datePublished">2017-09-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/algorithm/">algorithm</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/11/algorithm-stock/">best time to buy and sell stock</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h4 id="1-Best-Time-to-Buy-and-Sell-Stock"><a href="#1-Best-Time-to-Buy-and-Sell-Stock" class="headerlink" title="1. Best Time to Buy and Sell Stock"></a>1. Best Time to Buy and Sell Stock</h4><p>Say you have an array for which the <em>i</em>th element is the price of a given stock on day <em>i</em>.</p>
<p>If you were only permitted to complete at most one transaction (ie, buy one and sell one share of the stock), design an algorithm to find the maximum profit.</p>
<p><strong>Example 1:</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Input: [<span class="number">7</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">6</span>, <span class="number">4</span>]</div><div class="line">Output: <span class="number">5</span></div><div class="line"></div><div class="line">max. difference = <span class="number">6</span><span class="number">-1</span> = <span class="number">5</span> (not <span class="number">7</span><span class="number">-1</span> = <span class="number">6</span>, as selling price needs to be larger than buying price)</div></pre></td></tr></table></figure>
<p><strong>Example 2:</strong></p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">Input: [<span class="number">7</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">3</span>, <span class="number">1</span>]</div><div class="line">Output: <span class="number">0</span></div><div class="line"></div><div class="line">In this <span class="keyword">case</span>, no transaction is done, i.e. max profit = <span class="number">0.</span></div></pre></td></tr></table></figure>
<p><strong>Answer:</strong></p>
<p>for each time i with price = prices[i], we should find the minimum prices whose time j &lt; i </p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">MaxProfit</span><span class="params">(prices []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</div><div class="line">	min := math.MaxInt32</div><div class="line">	max := <span class="number">0</span></div><div class="line">	<span class="keyword">for</span> _, x := <span class="keyword">range</span> prices &#123;</div><div class="line">		temp := x - min</div><div class="line">		<span class="keyword">if</span> temp &gt; max &#123;</div><div class="line">			max = temp</div><div class="line">		&#125;</div><div class="line">		<span class="keyword">if</span> x &lt; min &#123;</div><div class="line">			min = x</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> max</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="2-Best-Time-to-Buy-and-Sell-Stock-II"><a href="#2-Best-Time-to-Buy-and-Sell-Stock-II" class="headerlink" title="2. Best Time to Buy and Sell Stock II"></a>2. Best Time to Buy and Sell Stock II</h4><p>Say you have an array for whichthe <em>i</em>th elementis the price of a given stock on day <em>i</em>.</p>
<p>Design an algorithm to find the maximum profit. You may completeas many transactions as you like (ie, buy one and sell one share of the stockmultiple times). However, you may not engage in multiple transactions at thesame time (ie, you must sell the stock before you buy again).</p>
<p>Example：</p>
<p>Input: [7, 1, 5,3, 6, 4]</p>
<p>Output: 7</p>
<p>Input: [7, 6, 4,3, 1]</p>
<p>Output: 0</p>
<p><strong>Answer:</strong></p>
<p>since we can do many transaction as we want, then we just need find every close valley and peak in the curve.</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">MaxprofileWithMultitransaction</span><span class="params">(prices []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</div><div class="line">	profile := <span class="number">0</span></div><div class="line">	<span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="built_in">len</span>(prices); i++ &#123;</div><div class="line">		<span class="keyword">if</span> prices[i] &gt; prices[i<span class="number">-1</span>] &#123;</div><div class="line">			profile += prices[i] - prices[i<span class="number">-1</span>]</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> profile</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="3-Best-Time-to-Buy-and-Sell-Stock-III"><a href="#3-Best-Time-to-Buy-and-Sell-Stock-III" class="headerlink" title="3.Best Time to Buy and Sell Stock III"></a>3.Best Time to Buy and Sell Stock III</h4><p>Say you have an array for which the <em>i</em>th element is the price of a given stock on day <em>i</em>.</p>
<p>Design an algorithm to find the maximum profit. You may complete at most <em>two</em> transactions.</p>
<p><strong>Note:</strong><br>You may not engage in multiple transactions at the same time (ie, you must sell the stock before you buy again).</p>
<p><strong>Answer:</strong></p>
<p>DP problem, prof[i] is the max profile with up to r transactions before time i.</p>
<p>m = max profile with up to r-1 transaction and prices[i] as buying price in the next transaction at time i</p>
<p>prof[i] = max(prof[i-1],prices[i]+m)</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">if</span> prices == <span class="literal">nil</span> || <span class="built_in">len</span>(prices) &lt;= <span class="number">0</span> &#123;</div><div class="line">		<span class="keyword">return</span> <span class="number">0</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	n := <span class="built_in">len</span>(prices)</div><div class="line">	prof := <span class="built_in">make</span>([]<span class="keyword">int</span>, n, n)</div><div class="line">	<span class="keyword">for</span> r := <span class="number">0</span>; r &lt; <span class="number">2</span>; r++ &#123;</div><div class="line">		m := prof[<span class="number">0</span>] - prices[<span class="number">0</span>]</div><div class="line">		<span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="built_in">len</span>(prices); i++ &#123;</div><div class="line">			m = max(m, prof[i]-prices[i])</div><div class="line">			prof[i] = max(prof[i<span class="number">-1</span>], prices[i]+m)</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> prof[n<span class="number">-1</span>]</div></pre></td></tr></table></figure>
<h4 id="4-Best-Time-to-Buy-and-Sell-Stock-IV"><a href="#4-Best-Time-to-Buy-and-Sell-Stock-IV" class="headerlink" title="4.Best Time to Buy and Sell Stock IV"></a>4.Best Time to Buy and Sell Stock IV</h4><p>Say you have an array for which the <em>i</em>th element is the price of a given stock on day <em>i</em>.</p>
<p>Design an algorithm to find the maximum profit. You may complete at most <strong>k</strong> transactions.</p>
<p><strong>Note:</strong><br>You may not engage in multiple transactions at the same time (ie, you must sell the stock before you buy again).</p>
<p><strong>Answer:</strong></p>
<p>DP problem </p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">prof[r][i] = max(prof[r][i<span class="number">-1</span>],prices[i]+m) <span class="comment">// max(profile with no transaction at time i,profile with transaction at time i)</span></div><div class="line">m = max(m,prof[r<span class="number">-1</span>][i<span class="number">-1</span>]-prices[i]) <span class="comment">// max profile with r-1 transaction at time i-1 and buying price = prices[i]</span></div></pre></td></tr></table></figure>
<p>代码</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// MaxProfitWithKTransactionDP 动态规划版本</span></div><div class="line"><span class="comment">// prof[r][j] 表示j时刻，最多r次交易可以获得的最大收益</span></div><div class="line"><span class="comment">// m = max(prof[r-1][j-1]-prices[j],m) 表示r-1笔交易情况下，j-1时刻的收益减去j时刻的价格的最大值</span></div><div class="line"><span class="comment">// m意义是基于r-1笔交易收益为prof[r-1][t]的前提下，找到一个低点买入，即需要找到一个时刻t，使得prof[r-1][t-1]-prices[t]值最大，这样才能在后续高点卖出，是的整体收益最大化</span></div><div class="line"><span class="comment">// 由于交易笔数k可能比较大，远远大于prices的长度，即这样交易笔数不在重要，只要有价差就可以买入卖出，所以当k&gt;len(prices)/2时，可以直接退化至任意笔操作</span></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">MaxProfitWithKTransactionDP</span><span class="params">(k <span class="keyword">int</span>, prices []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</div><div class="line">	<span class="keyword">if</span> prices == <span class="literal">nil</span> || <span class="built_in">len</span>(prices) &lt;= <span class="number">0</span> &#123;</div><div class="line">		<span class="keyword">return</span> <span class="number">0</span></div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">if</span> k &gt; <span class="built_in">len</span>(prices)/<span class="number">2</span> &#123;</div><div class="line">		<span class="keyword">return</span> quickSlove(prices)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	n := <span class="built_in">len</span>(prices)</div><div class="line">	prof := <span class="built_in">make</span>([][]<span class="keyword">int</span>, k+<span class="number">1</span>, k+<span class="number">1</span>)</div><div class="line">	<span class="keyword">for</span> i := <span class="number">0</span>; i &lt; k+<span class="number">1</span>; i++ &#123;</div><div class="line">		prof[i] = <span class="built_in">make</span>([]<span class="keyword">int</span>, n, n)</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">for</span> r := <span class="number">1</span>; r &lt;= k; r++ &#123;</div><div class="line">		m := prof[r][<span class="number">0</span>] - prices[<span class="number">0</span>]</div><div class="line">		<span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="built_in">len</span>(prices); i++ &#123;</div><div class="line">			prof[r][i] = max(prof[r][i<span class="number">-1</span>], prices[i]+m)</div><div class="line">			m = max(m, prof[r<span class="number">-1</span>][i<span class="number">-1</span>]-prices[i])</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line"></div><div class="line">	<span class="keyword">return</span> prof[k][n<span class="number">-1</span>]</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">max</span><span class="params">(a <span class="keyword">int</span>, b <span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</div><div class="line">	<span class="keyword">if</span> a &gt; b &#123;</div><div class="line">		<span class="keyword">return</span> a</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> b</div><div class="line">&#125;</div><div class="line"></div><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">quickSlove</span><span class="params">(prices []<span class="keyword">int</span>)</span> <span class="title">int</span></span> &#123;</div><div class="line">	profile := <span class="number">0</span></div><div class="line">	<span class="keyword">for</span> i := <span class="number">1</span>; i &lt; <span class="built_in">len</span>(prices); i++ &#123;</div><div class="line">		<span class="keyword">if</span> prices[i] &gt; prices[i<span class="number">-1</span>] &#123;</div><div class="line">			profile += prices[i] - prices[i<span class="number">-1</span>]</div><div class="line">		&#125;</div><div class="line">	&#125;</div><div class="line">	<span class="keyword">return</span> profile</div><div class="line">&#125;</div></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/09/11/algorithm-stock/" data-id="cj81680ys0000prbmw28aan5d" class="article-share-link">Share</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/algorithm/">algorithm</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-hello-world" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/09/04/hello-world/" class="article-date">
  <time datetime="2017-09-04T01:47:07.000Z" itemprop="datePublished">2017-09-04</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/09/04/hello-world/">Hello World</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Welcome to <a href="https://hexo.io/" target="_blank" rel="external">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/" target="_blank" rel="external">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html" target="_blank" rel="external">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo new <span class="string">"My New Post"</span></div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/writing.html" target="_blank" rel="external">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo server</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/server.html" target="_blank" rel="external">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo generate</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/generating.html" target="_blank" rel="external">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ hexo deploy</div></pre></td></tr></table></figure>
<p>More info: <a href="https://hexo.io/docs/deployment.html" target="_blank" rel="external">Deployment</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2017/09/04/hello-world/" data-id="cj81680z60004prbm2zylkrbt" class="article-share-link">Share</a>
      
      
    </footer>
  </div>
  
</article>


  

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/algorithm/">algorithm</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/algorithm/">algorithm</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/algorithm/" style="font-size: 10px;">algorithm</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2017/09/26/mysql性能入门/">(no title)</a>
          </li>
        
          <li>
            <a href="/2017/09/11/backend_share/">微服务简介</a>
          </li>
        
          <li>
            <a href="/2017/09/11/algorithm-stock/">best time to buy and sell stock</a>
          </li>
        
          <li>
            <a href="/2017/09/04/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2017 John Doe<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>

  </div>
</body>
</html>